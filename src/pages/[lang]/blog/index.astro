---
import { getCollection } from 'astro:content';
import Layout from '../../../layouts/Layout.astro';
import BlogPostPreview from '../../../components/BlogPostPreview.astro';
import { defaultLang, getDictionary, languages, type Lang } from '../../../i18n/ui';

export async function getStaticPaths() {
	return Object.keys(languages).map((lang) => ({
		params: { lang },
	}));
}

const lang = (Astro.params.lang ?? defaultLang) as Lang;
const dictionary = getDictionary(lang);

const posts = await getCollection('blog', ({ data }) => !data.draft && data.lang === lang);

const sortedPosts = posts.sort(
	(a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime()
);

const alternateLinks = Object.fromEntries(
	Object.keys(languages).map((code) => [code, `/${code}/blog/`])
);
---

<Layout
	lang={lang}
	alternateLinks={alternateLinks}
	title={`${dictionary.blogPageTitle} - ${dictionary.heroName}`}
	description={dictionary.blogPageDescription}
>
	<main class="min-h-screen py-12">
		<div class="mx-auto max-w-4xl px-4">
			<header class="mb-12">
				<h1 class="mb-4 text-4xl font-bold">{dictionary.blogPageTitle}</h1>
				<p class="text-lg text-base-content/70">{dictionary.blogPageDescription}</p>
			</header>

			<div class="space-y-6">
				{sortedPosts.length > 0 ? (
					sortedPosts.map((post) => (
						<BlogPostPreview
							title={post.data.title}
							excerpt={post.data.description}
							date={post.data.pubDate}
							href={`/${lang}/blog/${post.data.urlSlug}/`}
							locale={lang}
						/>
					))
				) : (
					<p class="italic text-base-content/60">{dictionary.emptyBlog}</p>
				)}
			</div>
		</div>
	</main>
</Layout>

