---
import { getCollection } from 'astro:content';
import Layout from '../../../layouts/Layout.astro';
import BlogPostPreview from '../../../components/BlogPostPreview.astro';
import { defaultLang, getDictionary, languages, type Lang } from '../../../i18n/ui';

export async function getStaticPaths() {
	return Object.keys(languages).map((lang) => ({
		params: { lang },
	}));
}

const lang = (Astro.params.lang ?? defaultLang) as Lang;
const dictionary = getDictionary(lang);

const posts = await getCollection('blog', ({ data }) => !data.draft && data.lang === lang);

const sortedPosts = posts.sort(
	(a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime()
);

const alternateLinks = Object.fromEntries(
	Object.keys(languages).map((code) => [code, `/${code}/blog/`])
);

const postsLabel =
	lang === 'es'
		? sortedPosts.length === 1
			? 'artículo'
			: 'artículos'
		: sortedPosts.length === 1
			? 'post'
			: 'posts';
---

<Layout
	lang={lang}
	alternateLinks={alternateLinks}
	title={`${dictionary.blogPageTitle} - ${dictionary.heroName}`}
	description={dictionary.blogPageDescription}
>
	<main class="py-6 sm:py-12">
		<div class="mx-auto flex max-w-5xl flex-col gap-10">
			<header class="pb-4">
				<div class="flex items-center justify-between gap-4">
					<p class="text-sm uppercase tracking-[0.4em] text-base-content/60">
						{dictionary.blogPageTitle}
					</p>
					<span class="text-xs uppercase tracking-widest text-base-content/60">
						{sortedPosts.length} {postsLabel}
					</span>
				</div>
				<h1 class="mt-3 text-4xl font-semibold leading-tight">{dictionary.blogPageTitle}</h1>
				<p class="mt-2 text-base text-base-content/70">{dictionary.blogPageDescription}</p>
			</header>

			{sortedPosts.length > 0 ? (
				<div class="grid gap-6 md:grid-cols-2">
					{sortedPosts.map((post) => (
						<BlogPostPreview
							title={post.data.title}
							excerpt={post.data.description}
							date={post.data.pubDate}
							href={`/${lang}/blog/${post.data.urlSlug}/`}
							locale={lang}
							ctaLabel={dictionary.readMore}
						/>
					))}
				</div>
			) : (
				<div class="card-accent p-8 text-base-content/70">
					<p class="italic">{dictionary.emptyBlog}</p>
				</div>
			)}
		</div>
	</main>
</Layout>

